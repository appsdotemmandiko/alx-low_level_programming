More functions and nested loops

Uses function prototypes included in the main.h header file
